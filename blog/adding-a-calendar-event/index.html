<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

<meta property="og:title" content="Adding a calendar event in android" />
<meta property="og:description" content="The android docs for the Calendar Provider are quite useful, but recommend the use of an AsyncQueryHandler for querying or adding events to calendars in an asynchronous thread. However the AsyncQueryHandler docs don&rsquo;t include much guidance as to how to use it.
To add an entry to an android calendar you first have to find out the calendar id using an asynchronous query on the calendars table.
// QueryHandler public class QueryHandler extends AsyncQueryHandler { private static final String TAG = &quot;QueryHandler&quot;; // Projection arrays private static final String[] CALENDAR_PROJECTION = new String[] { Calendars." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://billthefarmer.github.io/blog/adding-a-calendar-event/" />



<meta property="article:published_time" content="2017-09-05T14:54:25&#43;01:00"/>
<meta property="article:modified_time" content="2017-09-05T14:54:25&#43;01:00"/>












<meta itemprop="name" content="Adding a calendar event in android">
<meta itemprop="description" content="The android docs for the Calendar Provider are quite useful, but recommend the use of an AsyncQueryHandler for querying or adding events to calendars in an asynchronous thread. However the AsyncQueryHandler docs don&rsquo;t include much guidance as to how to use it.
To add an entry to an android calendar you first have to find out the calendar id using an asynchronous query on the calendars table.
// QueryHandler public class QueryHandler extends AsyncQueryHandler { private static final String TAG = &quot;QueryHandler&quot;; // Projection arrays private static final String[] CALENDAR_PROJECTION = new String[] { Calendars.">


<meta itemprop="dateModified" content="2017-09-05T14:54:25&#43;01:00" />
<meta itemprop="wordCount" content="531">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Adding a calendar event in android"/>
<meta name="twitter:description" content="The android docs for the Calendar Provider are quite useful, but recommend the use of an AsyncQueryHandler for querying or adding events to calendars in an asynchronous thread. However the AsyncQueryHandler docs don&rsquo;t include much guidance as to how to use it.
To add an entry to an android calendar you first have to find out the calendar id using an asynchronous query on the calendars table.
// QueryHandler public class QueryHandler extends AsyncQueryHandler { private static final String TAG = &quot;QueryHandler&quot;; // Projection arrays private static final String[] CALENDAR_PROJECTION = new String[] { Calendars."/>






<meta name="generator" content="Hugo 0.26" />


    <base href="https://billthefarmer.github.io/blog/">
    <link rel="canonical" href="https://billthefarmer.github.io/blog/adding-a-calendar-event/">
    <title>Adding a calendar event in android | Bill Farmer</title>

    <!-- CSS -->
    <link href="https://billthefarmer.github.io/blog/css/app.css" rel="stylesheet">

    

    

    
    
<style>
.callout.large {
    background-image: url(https://billthefarmer.github.io/blog/images/2013/12/cropped-P1010089.jpg);
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
}
.callout.large a, .callout.large p {
    color: white;
}
</style>



  </head>
  <body>

    <header class="nav">
      <div class="top-bar">
        <div class="row column">
          <div class="top-bar-left">
            <ul class="menu">
              <li><a href="https://billthefarmer.github.io/blog/">
                  Bill Farmer
                </a></li>
            </ul>
          </div>
          <div class="top-bar-right">
            <ul class="menu">
              <li class=""><a href="https://billthefarmer.github.io/blog/">
                Home
              </a></li>
              
                
                  <li><a href="https://billthefarmer.github.io/blog/index/">
                    Index
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/morris-o-meter/">
                    Morris-o-meter
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/about/">
                    About
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/test-o-meter/">
                    Test-o-meter
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/">
                    Bill Farmer
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/">
                    Categories
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/diy/">
                    Diy
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/hacking/">
                    Hacking
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/recipes/">
                    Recipes
                  </a></li>
                
              
            </ul>
          </div>
        </div>
      </div>
    </header>

    <header class="blog-header">
      <div class="callout large">
        <div class="row column text-center">
          <h1>
            <a href="https://billthefarmer.github.io/blog/" rel="home">Bill Farmer</a>
          </h1>
          
            <p>
              Random thoughts on random subjects
            </p>
          
        </div>
      </div>
    </header>

    <main>
      <div class="row" id="content">
        <div class="medium-8 columns">
          
  


  <div class="blog-post">
    <h3>
      <a href="https://billthefarmer.github.io/blog/adding-a-calendar-event/">Adding a calendar event in android</a>
    </h3>
    <div class="callout small">
      <small>
        <time datetime="2017-09-05T14:54:25&#43;01:00">
          Tue Sep 5, 2017
        </time> by Bill Farmer.
        Categories: 
  
    
      <a href="/blog/categories/hacking">
        Hacking
      </a>
  

.
        
        <br>
        
      </small>
    </div>
    <p>
      <p>The android docs for the <a href="https://developer.android.com/guide/topics/providers/calendar-provider.html">Calendar Provider</a> are quite useful, but
recommend the use of an <a href="https://developer.android.com/reference/android/content/AsyncQueryHandler.html">AsyncQueryHandler</a> for querying or adding
events to calendars in an asynchronous thread. However the
<code>AsyncQueryHandler</code> docs don&rsquo;t include much guidance as to how to use
it.</p>

<p>To add an entry to an android calendar you first have to find out the
calendar id using an asynchronous query on the calendars table.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic">// QueryHandler</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">QueryHandler</span> <span style="color: #008000; font-weight: bold">extends</span> AsyncQueryHandler
<span style="color: #666666">{</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">final</span> String TAG <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;QueryHandler&quot;</span><span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">// Projection arrays</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">final</span> String<span style="color: #666666">[]</span> CALENDAR_PROJECTION <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> String<span style="color: #666666">[]</span>
        <span style="color: #666666">{</span>
            Calendars<span style="color: #666666">.</span><span style="color: #7D9029">_ID</span>
        <span style="color: #666666">};</span>

    <span style="color: #408080; font-style: italic">// The indices for the projection array above.</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> CALENDAR_ID_INDEX <span style="color: #666666">=</span> <span style="color: #666666">0;</span>

    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> CALENDAR <span style="color: #666666">=</span> <span style="color: #666666">0;</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> EVENT    <span style="color: #666666">=</span> <span style="color: #666666">1;</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> REMINDER <span style="color: #666666">=</span> <span style="color: #666666">2;</span>

    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #008000; font-weight: bold">static</span> QueryHandler queryHandler<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">// QueryHandler</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #0000FF">QueryHandler</span><span style="color: #666666">(</span>ContentResolver resolver<span style="color: #666666">)</span>
    <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">(</span>resolver<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// insertEvent</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">insertEvent</span><span style="color: #666666">(</span>Context context<span style="color: #666666">,</span> <span style="color: #B00040">long</span> startTime<span style="color: #666666">,</span>
                                   <span style="color: #B00040">long</span> endTime<span style="color: #666666">,</span> String title<span style="color: #666666">)</span>
    <span style="color: #666666">{</span>
        ContentResolver resolver <span style="color: #666666">=</span> context<span style="color: #666666">.</span><span style="color: #7D9029">getContentResolver</span><span style="color: #666666">();</span>

        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>queryHandler <span style="color: #666666">==</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">)</span>
            queryHandler <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> QueryHandler<span style="color: #666666">(</span>resolver<span style="color: #666666">);</span>

        ContentValues values <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> ContentValues<span style="color: #666666">();</span>
        values<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>Events<span style="color: #666666">.</span><span style="color: #7D9029">DTSTART</span><span style="color: #666666">,</span> startTime<span style="color: #666666">);</span>
        values<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>Events<span style="color: #666666">.</span><span style="color: #7D9029">DTEND</span><span style="color: #666666">,</span> endTime<span style="color: #666666">);</span>
        values<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>Events<span style="color: #666666">.</span><span style="color: #7D9029">TITLE</span><span style="color: #666666">,</span> title<span style="color: #666666">);</span>

        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>BuildConfig<span style="color: #666666">.</span><span style="color: #7D9029">DEBUG</span><span style="color: #666666">)</span>
            Log<span style="color: #666666">.</span><span style="color: #7D9029">d</span><span style="color: #666666">(</span>TAG<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Calendar query start&quot;</span><span style="color: #666666">);</span>

        queryHandler<span style="color: #666666">.</span><span style="color: #7D9029">startQuery</span><span style="color: #666666">(</span>CALENDAR<span style="color: #666666">,</span> values<span style="color: #666666">,</span> Calendars<span style="color: #666666">.</span><span style="color: #7D9029">CONTENT_URI</span><span style="color: #666666">,</span>
                                CALENDAR_PROJECTION<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">);</span>
    <span style="color: #666666">}</span>
</pre></div>

<p>This method is called from an app activity.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>        QueryHandler<span style="color: #666666">.</span><span style="color: #7D9029">insertEvent</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">this</span><span style="color: #666666">,</span> startTime<span style="color: #666666">.</span><span style="color: #7D9029">getTimeInMillis</span><span style="color: #666666">(),</span>
                                 endTime<span style="color: #666666">.</span><span style="color: #7D9029">getTimeInMillis</span><span style="color: #666666">(),</span> title<span style="color: #666666">);</span>
</pre></div>

<p>The <code>insertEvent()</code> method first creates a new <code>QueryHandler</code> which is
subsequently reused. The start time, end time and title of the event
are added to a <code>ContentValues</code> object and passed to the <code>startQuery()</code>
method. This starts an asynchronous query on the Calendars table to
find the first calendar id. A database cursor and the values are
passed to the <code>onQueryComplete()</code> method.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>    <span style="color: #408080; font-style: italic">// onQueryComplete</span>
    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onQueryComplete</span><span style="color: #666666">(</span><span style="color: #B00040">int</span> token<span style="color: #666666">,</span> Object object<span style="color: #666666">,</span> Cursor cursor<span style="color: #666666">)</span>
    <span style="color: #666666">{</span>
        <span style="color: #408080; font-style: italic">// Use the cursor to move through the returned records</span>
        cursor<span style="color: #666666">.</span><span style="color: #7D9029">moveToFirst</span><span style="color: #666666">();</span>

        <span style="color: #408080; font-style: italic">// Get the field values</span>
        <span style="color: #B00040">long</span> calendarID <span style="color: #666666">=</span> cursor<span style="color: #666666">.</span><span style="color: #7D9029">getLong</span><span style="color: #666666">(</span>CALENDAR_ID_INDEX<span style="color: #666666">);</span>

        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>BuildConfig<span style="color: #666666">.</span><span style="color: #7D9029">DEBUG</span><span style="color: #666666">)</span>
            Log<span style="color: #666666">.</span><span style="color: #7D9029">d</span><span style="color: #666666">(</span>TAG<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Calendar query complete &quot;</span> <span style="color: #666666">+</span> calendarID<span style="color: #666666">);</span>

        ContentValues values <span style="color: #666666">=</span> <span style="color: #666666">(</span>ContentValues<span style="color: #666666">)</span> object<span style="color: #666666">;</span>
        values<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>Events<span style="color: #666666">.</span><span style="color: #7D9029">CALENDAR_ID</span><span style="color: #666666">,</span> calendarID<span style="color: #666666">);</span>
        values<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>Events<span style="color: #666666">.</span><span style="color: #7D9029">EVENT_TIMEZONE</span><span style="color: #666666">,</span>
                   TimeZone<span style="color: #666666">.</span><span style="color: #7D9029">getDefault</span><span style="color: #666666">().</span><span style="color: #7D9029">getDisplayName</span><span style="color: #666666">());</span>

        startInsert<span style="color: #666666">(</span>EVENT<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">,</span> Events<span style="color: #666666">.</span><span style="color: #7D9029">CONTENT_URI</span><span style="color: #666666">,</span> values<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>
</pre></div>

<p>This gets the calendar id from the cursor and adds it to the values
along with the timezone. It&rsquo;s probably not necessary to query the
first calendar id because the value seems to be one, but there may be
instances where it isn&rsquo;t. The <code>startInsert()</code> method inserts the event
asynchronously and the result is passed to the <code>onInsertComplete()</code>
method.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>    <span style="color: #408080; font-style: italic">// onInsertComplete</span>
    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onInsertComplete</span><span style="color: #666666">(</span><span style="color: #B00040">int</span> token<span style="color: #666666">,</span> Object object<span style="color: #666666">,</span> Uri uri<span style="color: #666666">)</span>
    <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>uri <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">)</span>
        <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>BuildConfig<span style="color: #666666">.</span><span style="color: #7D9029">DEBUG</span><span style="color: #666666">)</span>
                Log<span style="color: #666666">.</span><span style="color: #7D9029">d</span><span style="color: #666666">(</span>TAG<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Insert complete &quot;</span> <span style="color: #666666">+</span> uri<span style="color: #666666">.</span><span style="color: #7D9029">getLastPathSegment</span><span style="color: #666666">());</span>

            <span style="color: #008000; font-weight: bold">switch</span> <span style="color: #666666">(</span>token<span style="color: #666666">)</span>
            <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">case</span> EVENT<span style="color: #666666">:</span>
                <span style="color: #B00040">long</span> eventID <span style="color: #666666">=</span> Long<span style="color: #666666">.</span><span style="color: #7D9029">parseLong</span><span style="color: #666666">(</span>uri<span style="color: #666666">.</span><span style="color: #7D9029">getLastPathSegment</span><span style="color: #666666">());</span>
                ContentValues values <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> ContentValues<span style="color: #666666">();</span>
                values<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>Reminders<span style="color: #666666">.</span><span style="color: #7D9029">MINUTES</span><span style="color: #666666">,</span> <span style="color: #666666">10);</span>
                values<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>Reminders<span style="color: #666666">.</span><span style="color: #7D9029">EVENT_ID</span><span style="color: #666666">,</span> eventID<span style="color: #666666">);</span>
                values<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>Reminders<span style="color: #666666">.</span><span style="color: #7D9029">METHOD</span><span style="color: #666666">,</span> Reminders<span style="color: #666666">.</span><span style="color: #7D9029">METHOD_ALERT</span><span style="color: #666666">);</span>
                startInsert<span style="color: #666666">(</span>REMINDER<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">,</span> Reminders<span style="color: #666666">.</span><span style="color: #7D9029">CONTENT_URI</span><span style="color: #666666">,</span> values<span style="color: #666666">);</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #666666">}</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>
</pre></div>

<p>This gets the event id and inserts a 10 minute reminder. All the
<code>AsyncQueryHandler</code> asynchronous methods include an integer and an
<code>Object</code> in the argument list which are passed to the <code>onComplete()</code>
methods. This is useful for passing on parameters to be used later.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">09</span>-11 <span style="color: #666666">10</span>:27:56.518  <span style="color: #666666">9808</span>  <span style="color: #666666">9808</span> D QueryHandler: Calendar query start
<span style="color: #666666">09</span>-11 <span style="color: #666666">10</span>:27:56.687  <span style="color: #666666">9808</span>  <span style="color: #666666">9808</span> D QueryHandler: Calendar query <span style="color: #008000">complete</span> <span style="color: #666666">1</span>
<span style="color: #666666">09</span>-11 <span style="color: #666666">10</span>:27:56.801  <span style="color: #666666">9808</span>  <span style="color: #666666">9808</span> D QueryHandler: Insert <span style="color: #008000">complete</span> <span style="color: #666666">112</span>
<span style="color: #666666">09</span>-11 <span style="color: #666666">10</span>:27:56.944  <span style="color: #666666">9808</span>  <span style="color: #666666">9808</span> D QueryHandler: Insert <span style="color: #008000">complete</span> <span style="color: #666666">1</span>
</pre></div>

<p>Android takes a while to add the event as can be seen from the log.</p>

    </p>
    
    <hr>
  </div>

  


        </div>
          <div class="medium-3 columns" data-sticky-container>
  <div class="sticky" data-sticky data-anchor="content">

  

  

  <h4>Recent Posts</h4>
  <ul>
    
      <li><a href="/blog/adding-a-calendar-event/">
        Adding a calendar event in android
      </a></li>
    
      <li><a href="/blog/whatever-o-meter-revisited/">
        Whatever-o-meter revisited
      </a></li>
    
      <li><a href="/blog/migrating-blog-from-wordpress/">
        Migrating this blog from Wordpress
      </a></li>
    
      <li><a href="/blog/resolving-content-uris-in-android/">
        Resolving content uris in android
      </a></li>
    
      <li><a href="/blog/vegetables-cooked-in-olive-oil/">
        Vegetables cooked in olive oil
      </a></li>
    
      <li><a href="/blog/slow-cooked-ox-cheek/">
        Slow cooked ox cheek
      </a></li>
    
      <li><a href="/blog/handling-run-time-changes-in-android/">
        Handling run time changes in Android
      </a></li>
    
      <li><a href="/blog/using-emacs-as-an-ide/">
        Using Emacs as an IDE
      </a></li>
    
      <li><a href="/blog/upgrading-a-moto-g/">
        Upgrading a Moto G
      </a></li>
    
      <li><a href="/blog/replacing-micro-bore-radiators/">
        Replacing micro-bore radiators
      </a></li>
    
  </ul>

  
    <h4>Links</h4>
    <ul>
      
        <li><a href="https://github.com/billthefarmer">
          Github
        </a></li>
      
        <li><a href="http://billthefarmer.github.io">
          Home page
        </a></li>
      
    </ul>
  

  </div>
</div>

      </div>
    </main>

    <footer class="blog-footer">
      <div class="row column">
        <p>
          
          Copyright &copy; 2017 Bill Farmer
          
        </p>
        <p>
          <a href="https://billthefarmer.github.io/blog/adding-a-calendar-event/#">Back to top</a>
        </p>
      </div>
    </footer>

  <foot>

    <script src="https://billthefarmer.github.io/blog/js/app.js"></script>

  </foot>
  </body>
</html>
