<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

<meta property="og:title" content="Whatever-o-meter revisited" />
<meta property="og:description" content="I wrote the whatever-o-meter about five years ago in PHP and Javascript as a Wordpress plugin. As I have migrated my blog to Hugo, I thought to have a go at reimplementing it. The exporter I used made a good job of translating the Wordpress custom fields to Hugo front matter parameters. I had to put dashes in quotes, otherwise they get interpreted as [&lt;nil&gt;].
intro: Please answer the following questions carefully and truthfully." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://billthefarmer.github.io/blog/whatever-o-meter-revisited/" />



<meta property="article:published_time" content="2017-08-24T11:47:00&#43;01:00"/>
<meta property="article:modified_time" content="2017-08-24T11:47:00&#43;01:00"/>












<meta itemprop="name" content="Whatever-o-meter revisited">
<meta itemprop="description" content="I wrote the whatever-o-meter about five years ago in PHP and Javascript as a Wordpress plugin. As I have migrated my blog to Hugo, I thought to have a go at reimplementing it. The exporter I used made a good job of translating the Wordpress custom fields to Hugo front matter parameters. I had to put dashes in quotes, otherwise they get interpreted as [&lt;nil&gt;].
intro: Please answer the following questions carefully and truthfully.">


<meta itemprop="dateModified" content="2017-08-24T11:47:00&#43;01:00" />
<meta itemprop="wordCount" content="540">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Whatever-o-meter revisited"/>
<meta name="twitter:description" content="I wrote the whatever-o-meter about five years ago in PHP and Javascript as a Wordpress plugin. As I have migrated my blog to Hugo, I thought to have a go at reimplementing it. The exporter I used made a good job of translating the Wordpress custom fields to Hugo front matter parameters. I had to put dashes in quotes, otherwise they get interpreted as [&lt;nil&gt;].
intro: Please answer the following questions carefully and truthfully."/>






<meta name="generator" content="Hugo 0.26" />


    <base href="https://billthefarmer.github.io/blog/">
    <link rel="canonical" href="https://billthefarmer.github.io/blog/whatever-o-meter-revisited/">
    <title>Whatever-o-meter revisited | Bill Farmer</title>

    <!-- CSS -->
    <link href="https://billthefarmer.github.io/blog/css/app.css" rel="stylesheet">

    

    

    
    
<style>
.callout.large {
    background-image: url(https://billthefarmer.github.io/blog/images/2013/12/cropped-P1010089.jpg);
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
}
.callout.large a, .callout.large p {
    color: white;
}
</style>



  </head>
  <body>

    <header class="nav">
      <div class="top-bar">
        <div class="row column">
          <div class="top-bar-left">
            <ul class="menu">
              <li><a href="https://billthefarmer.github.io/blog/">
                  Bill Farmer
                </a></li>
            </ul>
          </div>
          <div class="top-bar-right">
            <ul class="menu">
              <li class=""><a href="https://billthefarmer.github.io/blog/">
                Home
              </a></li>
              
                
                  <li><a href="https://billthefarmer.github.io/blog/index/">
                    Index
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/morris-o-meter/">
                    Morris-o-meter
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/about/">
                    About
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/test-o-meter/">
                    Test-o-meter
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/">
                    Bill Farmer
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/">
                    Categories
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/diy/">
                    Diy
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/hacking/">
                    Hacking
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/recipes/">
                    Recipes
                  </a></li>
                
              
            </ul>
          </div>
        </div>
      </div>
    </header>

    <header class="blog-header">
      <div class="callout large">
        <div class="row column text-center">
          <h1>
            <a href="https://billthefarmer.github.io/blog/" rel="home">Bill Farmer</a>
          </h1>
          
            <p>
              Random thoughts on random subjects
            </p>
          
        </div>
      </div>
    </header>

    <main>
      <div class="row" id="content">
        <div class="medium-8 columns">
          
  


  <div class="blog-post">
    <h3>
      <a href="https://billthefarmer.github.io/blog/whatever-o-meter-revisited/">Whatever-o-meter revisited</a>
    </h3>
    <div class="callout small">
      <small>
        <time datetime="2017-08-24T11:47:00&#43;01:00">
          Thu Aug 24, 2017
        </time> by Bill Farmer.
        Categories: 
  
    
      <a href="/blog/categories/hacking">
        Hacking
      </a>
  

.
        
        <br>
        
      </small>
    </div>
    <p>
      <p>I wrote the whatever-o-meter about five years ago in PHP and
Javascript as a Wordpress plugin. As I have migrated my blog to Hugo,
I thought to have a go at reimplementing it. The exporter I used made
a good job of translating the Wordpress custom fields to Hugo front
matter parameters. I had to put dashes in quotes, otherwise they get
interpreted as <code>[&lt;nil&gt;]</code>.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>intro: Please answer the following questions carefully and truthfully.
question:
  - You are lying in bed on Monday morning...
result:
  - <span style="color: #BA2121">&#39;%d</span><span style="color: #19177C"> </span><span style="color: #BA2121">percent,</span><span style="color: #19177C"> </span><span style="color: #BA2121">Perhaps</span><span style="color: #19177C"> </span><span style="color: #BA2121">you</span><span style="color: #19177C"> </span><span style="color: #BA2121">should</span><span style="color: #19177C"> </span><span style="color: #BA2121">consider</span><span style="color: #19177C"> </span><span style="color: #BA2121">emigration.&#39;</span>
  - <span style="color: #BA2121">&#39;%d%,</span><span style="color: #19177C"> </span><span style="color: #BA2121">Consider</span><span style="color: #19177C"> </span><span style="color: #BA2121">taking</span><span style="color: #19177C"> </span><span style="color: #BA2121">a</span><span style="color: #19177C"> </span><span style="color: #BA2121">long</span><span style="color: #19177C"> </span><span style="color: #BA2121">holiday</span><span style="color: #19177C"> </span><span style="color: #BA2121">somewhere</span><span style="color: #19177C"> </span><span style="color: #BA2121">far</span><span style="color: #19177C"> </span><span style="color: #BA2121">away.&#39;</span>
left:
  - Go and jump in the shower quick
right:
  - Jump on him
weights: 2,1,1,1,1
centre:
  - <span style="color: #BA2121">&#39;-&#39;</span>
  - <span style="color: #BA2121">&#39;-&#39;</span>
  - So so
more: https://billthefarmer.github.io/blog/morris-o-meter
</pre></div>

<p>The javascript part should just work as it is, the PHP plugin needed
re-implementing as a hugo shortcode. The first part of the plugin just
outputs svg code to draw the dial and pointer, that was fairly easy to
implement, it just has some iteration in it. I had to change the ticks
slightly as Hugo doesn&rsquo;t appear to support floating point arithmetic
in templates.</p>

<p>The really difficult part was reading the page parameters, as most of
them are optional, and some of the arrays can have bits missing. PHP
just coped with that, anything not defined just becomes <code>null</code>. In
Hugo I had to make a great deal of use of <code>default</code> and <code>slice</code> to
create default values.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  &lt;<span style="color: #008000; font-weight: bold">div</span> <span style="color: #7D9029">id</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;first&quot;</span> <span style="color: #7D9029">style</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;text-align: center&quot;</span>&gt;
    &lt;<span style="color: #008000; font-weight: bold">h4</span>&gt;{{ .intro }}&lt;/<span style="color: #008000; font-weight: bold">h4</span>&gt;
    &lt;<span style="color: #008000; font-weight: bold">input</span> <span style="color: #7D9029">type</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;button&quot;</span> <span style="color: #7D9029">value</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;Start&quot;</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;start&quot;</span> <span style="color: #7D9029">id</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;start&quot;</span> /&gt;
  &lt;/<span style="color: #008000; font-weight: bold">div</span>&gt;
  {{ $questions := .question }}
  {{ $left_texts := default (slice &quot;No&quot;) .left }}
  {{ $centre_texts := default (slice &quot;-&quot;) (default .centre .center) }}
  {{ $right_texts := default (slice &quot;Yes&quot;) .right }}
  {{ $last_index := sub (len $questions) 1 }}
  {{ range $index, $question := $questions }}
  {{ $left := default &quot;No&quot; (index $left_texts $index) }}
  {{ $centre := default &quot;-&quot; (index $centre_texts $index) }}
  {{ $right := default &quot;Yes&quot; (index $right_texts $index) }}
</pre></div>

<p>The other difficult part was extracting optional parameters to pass as
json to the javascript. I had to use <code>Scratch</code> inside if blocks to
save values. Luckily <code>Scratch.Get</code> returns <code>null</code> if the key doesn&rsquo;t
exist.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>{{ with .result }}
{{ $.Scratch.Set &quot;results&quot; . }}
{{ end }}
{{ with (default .colors .colours) }}
{{ $.Scratch.Set &quot;colours&quot; (split . &quot;,&quot;) }}
{{ end }}
{{ with .weights }}
{{ $.Scratch.Set &quot;weights&quot; (split . &quot;,&quot;) }}
{{ end }}
{{ with .duration }}
{{ $.Scratch.Set &quot;duration&quot; . }}
{{ end }}
{{ with .easing }}
{{ $.Scratch.Set &quot;easing&quot; . }}
{{ end }}
{{ $json := dict &quot;results&quot; ($.Scratch.Get &quot;results&quot;) &quot;colours&quot; ($.Scratch.Get &quot;colours&quot;)
                 &quot;weights&quot; ($.Scratch.Get &quot;weights&quot;) &quot;duration&quot; ($.Scratch.Get &quot;duration&quot;)
                 &quot;easing&quot; ($.Scratch.Get &quot;easing&quot;) }}
&lt;<span style="color: #008000; font-weight: bold">script</span> <span style="color: #7D9029">type</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;text/javascript&quot;</span>&gt;
  <span style="color: #008000; font-weight: bold">var</span> whatever_data <span style="color: #666666">=</span> {{ safeJS (jsonify $json) }};
&lt;/<span style="color: #008000; font-weight: bold">script</span>&gt;
{{ end }}
</pre></div>

<p>So the generated json looks like this, with nulls for the missing keys.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&lt;</span>script type<span style="color: #666666">=</span><span style="color: #BA2121">&quot;text/javascript&quot;</span><span style="color: #666666">&gt;</span>
<span style="color: #008000; font-weight: bold">var</span> whatever_data <span style="color: #666666">=</span>
  {<span style="color: #BA2121">&quot;colours&quot;</span><span style="color: #666666">:</span><span style="color: #008000; font-weight: bold">null</span>,<span style="color: #BA2121">&quot;duration&quot;</span><span style="color: #666666">:</span><span style="color: #008000; font-weight: bold">null</span>,<span style="color: #BA2121">&quot;easing&quot;</span><span style="color: #666666">:</span><span style="color: #008000; font-weight: bold">null</span>,<span style="color: #BA2121">&quot;results&quot;</span><span style="color: #666666">:</span>[<span style="color: #BA2121">&quot;%d percent,</span>
<span style="color: #BA2121">    Perhaps you should consider emigration.&quot;</span>,...],<span style="color: #BA2121">&quot;weights&quot;</span><span style="color: #666666">:</span>[<span style="color: #BA2121">&quot;2&quot;</span>,<span style="color: #BA2121">&quot;1&quot;</span>,<span style="color: #BA2121">&quot;1&quot;</span>,<span style="color: #BA2121">&quot;1&quot;</span>,<span style="color: #BA2121">&quot;1&quot;</span>]};
<span style="color: #666666">&lt;</span><span style="border: 1px solid #FF0000">/script&gt;</span>
</pre></div>

<p>The javascript code needed a bit of work to force the weights, which
were passed by Hugo as an array of strings, to be interpreted as numbers.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>        <span style="color: #408080; font-style: italic">// Check if weights are defined</span>
        <span style="color: #008000; font-weight: bold">if</span> (weights <span style="color: #666666">==</span> <span style="color: #008000; font-weight: bold">null</span>)
        {
            value <span style="color: #666666">+=</span> $(<span style="color: #BA2121">&quot;#value-&quot;</span> <span style="color: #666666">+</span> panel).slider(<span style="color: #BA2121">&quot;value&quot;</span>);
            total<span style="color: #666666">++</span>;
        }

        <span style="color: #008000; font-weight: bold">else</span>
        {
            value <span style="color: #666666">+=</span> $(<span style="color: #BA2121">&quot;#value-&quot;</span> <span style="color: #666666">+</span> panel).slider(<span style="color: #BA2121">&quot;value&quot;</span>) <span style="color: #666666">*</span>
	        weights[index];
            total <span style="color: #666666">+=</span> <span style="color: #666666">+</span>weights[index];
        }
</pre></div>

    </p>
    
    <hr>
  </div>

  


        </div>
          <div class="medium-3 columns" data-sticky-container>
  <div class="sticky" data-sticky data-anchor="content">

  

  

  <h4>Recent Posts</h4>
  <ul>
    
      <li><a href="/blog/adding-a-calendar-event/">
        Adding a calendar event in android
      </a></li>
    
      <li><a href="/blog/whatever-o-meter-revisited/">
        Whatever-o-meter revisited
      </a></li>
    
      <li><a href="/blog/migrating-blog-from-wordpress/">
        Migrating this blog from Wordpress
      </a></li>
    
      <li><a href="/blog/resolving-content-uris-in-android/">
        Resolving content uris in android
      </a></li>
    
      <li><a href="/blog/vegetables-cooked-in-olive-oil/">
        Vegetables cooked in olive oil
      </a></li>
    
      <li><a href="/blog/slow-cooked-ox-cheek/">
        Slow cooked ox cheek
      </a></li>
    
      <li><a href="/blog/handling-run-time-changes-in-android/">
        Handling run time changes in Android
      </a></li>
    
      <li><a href="/blog/using-emacs-as-an-ide/">
        Using Emacs as an IDE
      </a></li>
    
      <li><a href="/blog/upgrading-a-moto-g/">
        Upgrading a Moto G
      </a></li>
    
      <li><a href="/blog/replacing-micro-bore-radiators/">
        Replacing micro-bore radiators
      </a></li>
    
  </ul>

  
    <h4>Links</h4>
    <ul>
      
        <li><a href="https://github.com/billthefarmer">
          Github
        </a></li>
      
        <li><a href="http://billthefarmer.github.io">
          Home page
        </a></li>
      
    </ul>
  

  </div>
</div>

      </div>
    </main>

    <footer class="blog-footer">
      <div class="row column">
        <p>
          
          Copyright &copy; 2017 Bill Farmer
          
        </p>
        <p>
          <a href="https://billthefarmer.github.io/blog/whatever-o-meter-revisited/#">Back to top</a>
        </p>
      </div>
    </footer>

  <foot>

    <script src="https://billthefarmer.github.io/blog/js/app.js"></script>

  </foot>
  </body>
</html>
