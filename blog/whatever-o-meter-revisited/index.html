<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

<meta property="og:title" content="Whatever-o-meter revisited" />
<meta property="og:description" content="I wrote the whatever-o-meter about five years ago in PHP and Javascript as a Wordpress plugin. As I have migrated my blog to Hugo, I thought to have a go at reimplementing it. The exporter I used made a good job of translating the Wordpress custom fields to Hugo front matter parameters. I had to put dashes in quotes, otherwise they get interpreted as [&lt;nil&gt;].
intro:Pleaseanswerthefollowingquestionscarefullyandtruthfully.question:-YouarelyinginbedonMondaymorning...result:-&#39;%d percent, Perhaps you should consider emigration." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://billthefarmer.github.io/blog/whatever-o-meter-revisited/" />
<meta property="article:published_time" content="2017-08-24T11:47:00&#43;01:00"/>
<meta property="article:modified_time" content="2017-08-24T11:47:00&#43;01:00"/>


<meta itemprop="name" content="Whatever-o-meter revisited">
<meta itemprop="description" content="I wrote the whatever-o-meter about five years ago in PHP and Javascript as a Wordpress plugin. As I have migrated my blog to Hugo, I thought to have a go at reimplementing it. The exporter I used made a good job of translating the Wordpress custom fields to Hugo front matter parameters. I had to put dashes in quotes, otherwise they get interpreted as [&lt;nil&gt;].
intro:Pleaseanswerthefollowingquestionscarefullyandtruthfully.question:-YouarelyinginbedonMondaymorning...result:-&#39;%d percent, Perhaps you should consider emigration.">


<meta itemprop="datePublished" content="2017-08-24T11:47:00&#43;01:00" />
<meta itemprop="dateModified" content="2017-08-24T11:47:00&#43;01:00" />
<meta itemprop="wordCount" content="509">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Whatever-o-meter revisited"/>
<meta name="twitter:description" content="I wrote the whatever-o-meter about five years ago in PHP and Javascript as a Wordpress plugin. As I have migrated my blog to Hugo, I thought to have a go at reimplementing it. The exporter I used made a good job of translating the Wordpress custom fields to Hugo front matter parameters. I had to put dashes in quotes, otherwise they get interpreted as [&lt;nil&gt;].
intro:Pleaseanswerthefollowingquestionscarefullyandtruthfully.question:-YouarelyinginbedonMondaymorning...result:-&#39;%d percent, Perhaps you should consider emigration."/>






<meta name="generator" content="Hugo 0.55.6" />


    <base href="https://billthefarmer.github.io/blog/">
    <link rel="canonical" href="https://billthefarmer.github.io/blog/whatever-o-meter-revisited/">
    <title>Whatever-o-meter revisited | Bill Farmer</title>

    <!-- CSS -->
    <link href="https://billthefarmer.github.io/blog/css/app.css" rel="stylesheet">
    
    

    
    

<style>
.callout.large {
    background-image: url(https://billthefarmer.github.io/blog/images/2013/12/cropped-P1010089.jpg);
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
}
.callout.large a, .callout.large p {
    color: white;
}
pre {
    margin-top: 16px;
    margin-bottom: 16px;
}
code {
    padding: 0;
    border: 0;
    background-color: #fff;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    font-weight: normal;
    color: #0a0a0a;
}
</style>




  </head>
  <body>

    <header class="nav">
      <div class="top-bar">
        <div class="row column">
          <div class="top-bar-left">
            <ul class="menu">
              <li><a href="https://billthefarmer.github.io/blog/">
                  Bill Farmer
                </a></li>
            </ul>
          </div>
          <div class="top-bar-right">
            <ul class="menu">
              <li class=""><a href="https://billthefarmer.github.io/blog/">
                Home
              </a></li>
              
                
                  <li><a href="https://billthefarmer.github.io/blog/">
                    Bill Farmer
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/">
                    Categories
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/diy/">
                    DIY
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/hacking/">
                    Hacking
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/recipes/">
                    Recipes
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/categories/electronics/">
                    Electronics
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/index/">
                    Index
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/morris-o-meter/">
                    Morris-o-meter
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/about/">
                    About
                  </a></li>
                
                  <li><a href="https://billthefarmer.github.io/blog/test-o-meter/">
                    Test-o-meter
                  </a></li>
                
              
            </ul>
          </div>
        </div>
      </div>
    </header>

    <header class="blog-header">
      <div class="callout large">
        <div class="row column text-center">
          <h1>
            <a href="https://billthefarmer.github.io/blog/" rel="home">Bill Farmer</a>
          </h1>
          
            <p>
              Random thoughts on random subjects
            </p>
          
        </div>
      </div>
    </header>

    <main>
      <div class="row" id="content">
        <div class="medium-8 columns">
          
  


  <div class="blog-post">
    <h3>
      <a href="https://billthefarmer.github.io/blog/whatever-o-meter-revisited/">Whatever-o-meter revisited</a>
    </h3>
    <div class="callout small">
      <small>
        <time datetime="2017-08-24T11:47:00&#43;01:00">
          Thu Aug 24, 2017
        </time> by Bill Farmer.
        Categories: 
  
    
      <a href="/blog/categories/hacking">
        Hacking
      </a>
  

.
        
        <br>
        
      </small>
    </div>
    <p>
      <p>I wrote the whatever-o-meter about five years ago in PHP and
Javascript as a Wordpress plugin. As I have migrated my blog to Hugo,
I thought to have a go at reimplementing it. The exporter I used made
a good job of translating the Wordpress custom fields to Hugo front
matter parameters. I had to put dashes in quotes, otherwise they get
interpreted as <code>[&lt;nil&gt;]</code>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">intro:<span style="color:#bbb"> </span>Please<span style="color:#bbb"> </span>answer<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>following<span style="color:#bbb"> </span>questions<span style="color:#bbb"> </span>carefully<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>truthfully.<span style="color:#bbb">
</span><span style="color:#bbb"></span>question:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>You<span style="color:#bbb"> </span>are<span style="color:#bbb"> </span>lying<span style="color:#bbb"> </span>in<span style="color:#bbb"> </span>bed<span style="color:#bbb"> </span>on<span style="color:#bbb"> </span>Monday<span style="color:#bbb"> </span>morning...<span style="color:#bbb">
</span><span style="color:#bbb"></span>result:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#39;%d percent, Perhaps you should consider emigration.&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#39;%d%, Consider taking a long holiday somewhere far away.&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>left:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>Go<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>jump<span style="color:#bbb"> </span>in<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>shower<span style="color:#bbb"> </span>quick<span style="color:#bbb">
</span><span style="color:#bbb"></span>right:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>Jump<span style="color:#bbb"> </span>on<span style="color:#bbb"> </span>him<span style="color:#bbb">
</span><span style="color:#bbb"></span>weights:<span style="color:#bbb"> </span><span style="color:#666">2</span>,<span style="color:#666">1</span>,<span style="color:#666">1</span>,<span style="color:#666">1</span>,<span style="color:#666">1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>centre:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#39;-&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#39;-&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>So<span style="color:#bbb"> </span>so<span style="color:#bbb">
</span><span style="color:#bbb"></span>more:<span style="color:#bbb"> </span>https://billthefarmer.github.io/blog/morris-o-meter</code></pre></div>
<p>The javascript part should just work as it is, the PHP plugin needed
re-implementing as a hugo shortcode. The first part of the plugin just
outputs svg code to draw the dial and pointer, that was fairly easy to
implement, it just has some iteration in it. I had to change the ticks
slightly as Hugo doesn&rsquo;t appear to support floating point arithmetic
in templates.</p>

<p>The really difficult part was reading the page parameters, as most of
them are optional, and some of the arrays can have bits missing. PHP
just coped with that, anything not defined just becomes <code>null</code>. In
Hugo I had to make a great deal of use of <code>default</code> and <code>slice</code> to
create default values.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">{{ with .Page.Params }}
  &lt;<span style="color:#008000;font-weight:bold">div</span> <span style="color:#b44">id</span><span style="color:#666">=</span><span style="color:#b44">&#34;first&#34;</span> <span style="color:#b44">style</span><span style="color:#666">=</span><span style="color:#b44">&#34;text-align: center&#34;</span>&gt;
    &lt;<span style="color:#008000;font-weight:bold">h4</span>&gt;{{ .intro }}&lt;/<span style="color:#008000;font-weight:bold">h4</span>&gt;
    &lt;<span style="color:#008000;font-weight:bold">input</span> <span style="color:#b44">type</span><span style="color:#666">=</span><span style="color:#b44">&#34;button&#34;</span> <span style="color:#b44">value</span><span style="color:#666">=</span><span style="color:#b44">&#34;Start&#34;</span> <span style="color:#b44">class</span><span style="color:#666">=</span><span style="color:#b44">&#34;start&#34;</span> <span style="color:#b44">id</span><span style="color:#666">=</span><span style="color:#b44">&#34;start&#34;</span> /&gt;
  &lt;/<span style="color:#008000;font-weight:bold">div</span>&gt;
  {{ $questions := .question }}
  {{ $left_texts := default (slice &#34;No&#34;) .left }}
  {{ $centre_texts := default (slice &#34;-&#34;) (default .centre .center) }}
  {{ $right_texts := default (slice &#34;Yes&#34;) .right }}
  {{ $last_index := sub (len $questions) 1 }}
  {{ range $index, $question := $questions }}
  {{ $left := default &#34;No&#34; (index $left_texts $index) }}
  {{ $centre := default &#34;-&#34; (index $centre_texts $index) }}
  {{ $right := default &#34;Yes&#34; (index $right_texts $index) }}</code></pre></div>
<p>The other difficult part was extracting optional parameters to pass as
json to the javascript. I had to use <code>Scratch</code> inside with blocks to
save values. Luckily <code>Scratch.Get</code> returns <code>null</code> if the key doesn&rsquo;t
exist.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">{{ with .result }}
{{ $.Scratch.Set &#34;results&#34; . }}
{{ end }}
{{ with (default .colors .colours) }}
{{ $.Scratch.Set &#34;colours&#34; (split . &#34;,&#34;) }}
{{ end }}
{{ with .weights }}
{{ $.Scratch.Set &#34;weights&#34; (split . &#34;,&#34;) }}
{{ end }}
{{ with .duration }}
{{ $.Scratch.Set &#34;duration&#34; . }}
{{ end }}
{{ with .easing }}
{{ $.Scratch.Set &#34;easing&#34; . }}
{{ end }}
{{ $json := dict &#34;results&#34; ($.Scratch.Get &#34;results&#34;) &#34;colours&#34; ($.Scratch.Get &#34;colours&#34;)
                 &#34;weights&#34; ($.Scratch.Get &#34;weights&#34;) &#34;duration&#34; ($.Scratch.Get &#34;duration&#34;)
                 &#34;easing&#34; ($.Scratch.Get &#34;easing&#34;) }}
&lt;<span style="color:#008000;font-weight:bold">script</span> <span style="color:#b44">type</span><span style="color:#666">=</span><span style="color:#b44">&#34;text/javascript&#34;</span>&gt;
  <span style="color:#a2f;font-weight:bold">var</span> whatever_data <span style="color:#666">=</span> {{ safeJS (jsonify $json) }};
&lt;/<span style="color:#008000;font-weight:bold">script</span>&gt;
{{ end }}</code></pre></div>
<p>So the generated json looks like this, with nulls for the missing keys.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#666">&lt;</span>script type<span style="color:#666">=</span><span style="color:#b44">&#34;text/javascript&#34;</span><span style="color:#666">&gt;</span>
<span style="color:#a2f;font-weight:bold">var</span> whatever_data <span style="color:#666">=</span>
  {<span style="color:#b44">&#34;colours&#34;</span><span style="color:#666">:</span><span style="color:#a2f;font-weight:bold">null</span>,<span style="color:#b44">&#34;duration&#34;</span><span style="color:#666">:</span><span style="color:#a2f;font-weight:bold">null</span>,<span style="color:#b44">&#34;easing&#34;</span><span style="color:#666">:</span><span style="color:#a2f;font-weight:bold">null</span>,<span style="color:#b44">&#34;results&#34;</span><span style="color:#666">:</span>[<span style="color:#b44">&#34;%d percent,
</span><span style="color:#b44">    Perhaps you should consider emigration.&#34;</span>,...],<span style="color:#b44">&#34;weights&#34;</span><span style="color:#666">:</span>[<span style="color:#b44">&#34;2&#34;</span>,<span style="color:#b44">&#34;1&#34;</span>,<span style="color:#b44">&#34;1&#34;</span>,<span style="color:#b44">&#34;1&#34;</span>,<span style="color:#b44">&#34;1&#34;</span>]};
<span style="color:#666">&lt;</span><span style="">/script&gt;</span>
</code></pre></div>
<p>The javascript code needed a bit of work to force the weights, which
were passed by Hugo as an array of strings, to be interpreted as numbers.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">        <span style="color:#080;font-style:italic">// Check if weights are defined
</span><span style="color:#080;font-style:italic"></span>        <span style="color:#a2f;font-weight:bold">if</span> (weights <span style="color:#666">==</span> <span style="color:#a2f;font-weight:bold">null</span>)
        {
            value <span style="color:#666">+=</span> $(<span style="color:#b44">&#34;#value-&#34;</span> <span style="color:#666">+</span> panel).slider(<span style="color:#b44">&#34;value&#34;</span>);
            total<span style="color:#666">++</span>;
        }

        <span style="color:#a2f;font-weight:bold">else</span>
        {
            value <span style="color:#666">+=</span> $(<span style="color:#b44">&#34;#value-&#34;</span> <span style="color:#666">+</span> panel).slider(<span style="color:#b44">&#34;value&#34;</span>) <span style="color:#666">*</span>
	        weights[index];
            total <span style="color:#666">+=</span> <span style="color:#666">+</span>weights[index];
        }
</code></pre></div>
    </p>
    
    

<hr>
<h3>See Also</h3>
<ul>
  
  <li><a href="/blog/whatever-o-meter/">Whatever-o-meter</a></li>
  
  <li><a href="/blog/post/questionnaire/">Questionnaire Maker</a></li>
  
  <li><a href="/blog/post/create-pdf-report/">Create PDF Report</a></li>
  
  <li><a href="/blog/migrating-blog-from-wordpress/">Migrating this blog from Wordpress</a></li>
  
  <li><a href="/blog/slimstat/">SlimStat</a></li>
  
</ul>


      <hr>
  </div>

  


        </div>
          <div class="medium-3 columns" data-sticky-container>
  <div class="sticky" data-sticky data-anchor="content">

  

  

  <h4>Recent Posts</h4>
  <ul>
    
      <li><a href="/blog/fixing-basin-waste-pop-up/">
        Fixing Basin Waste Pop Up
      </a></li>
    
      <li><a href="/blog/pi-hole-cloudflare-setup/">
        Pi-hole Cloudflare, DNSCrypt, Unbound Setup
      </a></li>
    
      <li><a href="/blog/post/mushrooms-and-soy-sauce/">
        Mushrooms and Soy Sauce
      </a></li>
    
      <li><a href="/blog/post/source-code-highlighting/">
        Source Code Syntax Highlighting
      </a></li>
    
      <li><a href="/blog/post/musical-temperaments/">
        Musical Temperaments
      </a></li>
    
      <li><a href="/blog/post/draw-musical-staff/">
        Draw Musical Staff
      </a></li>
    
      <li><a href="/blog/post/expand-android-selection/">
        Expand Android Selection
      </a></li>
    
      <li><a href="/blog/interesting-mash/">
        Interesting Mash
      </a></li>
    
      <li><a href="/blog/green-tomatoes/">
        Green Tomatoes
      </a></li>
    
      <li><a href="/blog/post/create-pdf-report/">
        Create PDF Report
      </a></li>
    
  </ul>

  
    <h4>Links</h4>
    <ul>
      
        <li><a href="https://github.com/billthefarmer">
          Github
        </a></li>
      
        <li><a href="https://gitlab.com/williamjfarmer">
          Gitlab
        </a></li>
      
        <li><a href="http://billthefarmer.github.io">
          Home
        </a></li>
      
    </ul>
  

  </div>
</div>

      </div>
    </main>

    <footer class="blog-footer">
      <div class="row column">
        <p>
          
          Copyright &copy; 2019 Bill Farmer
          
        </p>
        <p>
          <a href="https://billthefarmer.github.io/blog/whatever-o-meter-revisited/#">Back to top</a>
        </p>
      </div>
    </footer>

  <foot>

    <script src="https://billthefarmer.github.io/blog/js/app.js"></script>

  </foot>
  </body>
</html>
